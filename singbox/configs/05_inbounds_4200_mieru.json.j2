{
    "inbounds":[
        {% if  hconfigs['mieru_enable'] %}
            {% set default_ports = domains | selectattr('internal_port_mieru') | map(attribute='internal_port_mieru') | list %}
            {% set default_ports = default_ports if default_ports else [4200] %}
            {% set ports = hconfigs["mieru_tcp_ports"].split(",") if hconfigs["mieru_tcp_ports"] else default_ports %}
            {% set udp_ports = hconfigs["mieru_udp_ports"].split(",") if hconfigs["mieru_udp_ports"] else default_ports %}
            
                {
                    "tag":"v10-mieru-tcp",
                    "listen": "0.0.0.0",
                    "listen_port": {{ ports[0] }},
                    "tcp_fast_open": true,
                    "sniff": true,
                    "sniff_override_destination": true,
                    "domain_strategy": "prefer_ipv4",
                    {% include '/opt/hiddify-manager/singbox/configs/common/protocols/mieru.pj2' %},
                },    
            
                {
                    "tag":"v10-mieru-udp",
                    "listen": "0.0.0.0",
                    "listen_port": {{ udp_ports[0] }},
                    "sniff": true,
                    "sniff_override_destination": true,
                    "domain_strategy": "prefer_ipv4",
                    {% include '/opt/hiddify-manager/singbox/configs/common/protocols/mieru.pj2' %},
                },    
            
        {%endif%}
    ]
}
